<!doctype html>
<html lang="en" class="theme-light">
  <head>
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    
<meta itemprop="description" name="description" content="A validation DSL generator based on pure functions and data." />
<meta property="og:title" content="Yet another validation DSL" />
<meta property='og:site_name' content='Dmitry Non' />
<meta property="og:url" content="https://nondv.wtf/blog/posts/yet-another-validation-dsl.html" />
<meta property="og:description" content="A validation DSL generator based on pure functions and data." />

  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2023-02-19" />
  <meta property="article:author" content="Dmitry Non" />
  <meta property="og:image" content="https://nondv.wtf/img/posts/gear-lightbulb.jpg" />
  <meta property="article:tag" content="DSL" />
  <meta property="article:tag" content="validation" />
  <meta property="article:tag" content="Ruby" />
  <meta property="article:tag" content="Clojure" />
  <meta property="article:tag" content="Weird Programming" />
  
<meta name="theme-color" content="#4A4A4A"/>
<link rel="apple-touch-icon" href="/img/favicon.svg" />


    <!-- Bulma -->
    <link rel="stylesheet" href="/css/bulma.1.0.4.min.css">
    <!-- Syntax highlight  -->
    <link rel="stylesheet" href="/css/syntax-highlight/perldoc.css">
    <!-- Custom shit and hacks -->
    <link rel="stylesheet" href="/css/other.css">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <title>Yet another validation DSL</title>
  </head>
  <body>
    <header class="has-background-light mb-4">
  <div class="container">
    <div class="columns is-vcentered">
      <div class="column is-narrow">
        <a href="/">
          <figure id="photo" class="image is-128x128">
            <img class="is-rounded" src="/img/avatar.jpg" />
          </figure>
        </a>
      </div>
      <div class="column">
        <div class="columns is-vcentered">
          <div class="column">
            <div class="title is-size-2">Dmitry Non</div>
            <div class="subtitle is-size-4 mb-4">Software Engineer</div>
            <nav class="breadcrumb has-bullet-separator" aria-label="breadcrumbs">
              <ul><li><a href="/"><span class="icon m-0"><i class="fas fa-user"></i></span>CV</a></li>
                  <li class="is-active"><a><span class="icon m-0"><i class="fas fa-pen"></i></span> Blog</a></li></ul>
            </nav>

          </div>
          <div class="column is-narrow">
            <a href="mailto:mail@nondv.io">
              <span class="icon">
                <i class="far fa-envelope"></i>
              </span>
              mail@nondv.io
            </a>
            <a class="is-block" target="_blank" href="https://www.linkedin.com/in/nondv/">
              <span class="icon">
                <i class="fab fa-linkedin"></i>
              </span>
              Nondv
            </a>
            <a class="is-block" target="_blank" href="https://github.com/Nondv">
              <span class="icon">
                <i class="fab fa-github"></i>
              </span>
              @Nondv
            </a>
            <a class="is-block" target="_blank" href="https://medium.com/@nondv">
              <span class="icon">
                <i class="fab fa-medium"></i>
              </span>
              @nondv
            </a>
            <a class="is-block" href="https://nondv.wtf/blog.html">
              <span class="icon">
                <i class="fas fa-pen"></i>
              </span>
              nondv.wtf/blog
            </a>
            <a class="is-block" href="https://nondv.wtf/blog/feed.xml">
              <span class="icon">
                <i class="fas fa-rss"></i>
              </span>
              Atom feed
            </a>
            <div>London, UK</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>



    <div class="container px-2">
      <nav class="breadcrumb mb-4" aria-label="breadcrumbs">
  <ul>
    <li><a href="/blog.html">Blog</a></li>
    <li><a href="/blog/categories">Categories</a></li>
    <li><div class="dropdown is-hoverable">
          <div class="dropdown-trigger">
            <a href="https://nondv.wtf/blog/categories/ruby">
              <span class="icon is-small mr-0 ml-0"><i class="fas fa-angle-down"></i></span>
              Ruby
            </a>
          </div>

          <div class="dropdown-menu">
            <div class="dropdown-content"><a style="justify-content: left" class="dropdown-item" href="https://nondv.wtf/blog/categories/clojure">
                  Clojure
                </a><a style="justify-content: left" class="dropdown-item" href="https://nondv.wtf/blog/categories/weird-programming">
                  Weird Programming
                </a></div>
          </div>
        </div></li>
    <li class="is-active"><a href="#" aria-current="page">Yet another validation DSL</a></li>
  </ul>
</nav>

<div class="title is-1">Yet another validation DSL</div>
<div class="subtitle"><time>19 Feb 2023</time></div>
<div class="is-size-5">
  
  
  
  <a href="http://twitter.com/share?url=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fyet-another-validation-dsl.html&text=Yet+another+validation+DSL" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-twitter"></i></span></a>
  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fyet-another-validation-dsl.html" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-linkedin"></i></span></a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fyet-another-validation-dsl.html" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-facebook"></i></span></a>
</div>
<figure class="mb-6 has-text-centered">
    <img class='post-image' src='/img/posts/gear-lightbulb.jpg' alt='Post image' /></figure><article class="content">
  <p>I’ve been reading my old essays and found <a href="https://habr.com/en/post/479600/">this one</a> written in Russian back
in 2019.</p>

<p>Essentially, it describes a Ruby <a href="https://github.com/Nondv/st_validation.rb">gem</a> (library) I had written that allows you to
create your own validation DSL as a bunch of functions and data. It emphises
simplicity and flexibility. I thought it had a really interesting idea behind it
so I’m going to rehash it here.</p>

<p>The below can be applied to any language (admittedly, it’ll be less convenient
in some). I wrote examples in Ruby and Clojure.</p>

<!--more-->

<h1 id="why-i-thought-yet-another-validation-dsl-was-a-good-idea">Why I thought yet another validation DSL was a good idea</h1>

<p>Modern validation libraries usually involve a lot of stuff. A <strong>lot</strong> of
stuff. You need to learn a bunch of library functions, read docs, sometimes even
a whole DSL. Also, they can be quite opinionated.</p>

<p>Now, to be completely honest with you, nowadays I don’t think it’s a bad
thing. But it’s always nice to play around with ideas.</p>

<h1 id="fundamentals">Fundamentals</h1>

<p>The goals I was aiming for with that library were:</p>

<ul>
  <li><strong>Simplicity</strong></li>
  <li>No magic</li>
  <li>Easy to learn</li>
  <li>Easy customisation with as little limitations as possible</li>
</ul>

<p>Basically, I wanted to make it as simple as possible.</p>

<h1 id="architecture">Architecture</h1>

<p>I based the library on 4 concepts:</p>

<ul>
  <li><strong>Validator</strong> - object (could be a function) that validates data. Is built
from a <em>blueprint</em> and <em>transformations</em>.</li>
  <li><strong>Blueprint</strong> - data that describes data we want to validate. For instance,
<code class="language-plaintext highlighter-rouge">:int</code> could represent an integer and <code class="language-plaintext highlighter-rouge">{name: :string, email: :email, age:
  :positive}</code> could represent a user.</li>
  <li><strong>Transformation</strong> - a function <code class="language-plaintext highlighter-rouge">t(b, f)</code> where <code class="language-plaintext highlighter-rouge">b</code> is a blueprint and <code class="language-plaintext highlighter-rouge">f</code> is
a validator factory (details below) that returns either a validator or a
blueprint. This is the core concept that I find interesting. Basically, a list
of transformations describes your DSL.</li>
  <li><strong>Factory</strong> is built from a list of transformations. It’s a function (well, an
object in the library) that takes a <em>blueprint</em> and passes it through all
transformations (continuously!) until a validator is created. Factory gets
stuck in an infinite loop, the schema is invalid (well, or the
transformations). The gem isn’t handling this very well though - it merely
checks if the blueprint stays the same after a full transformation cycle.</li>
</ul>

<p>All that is enough to <em>build your own</em> validation DSL.</p>

<h1 id="factory-implementation">Factory implementation</h1>

<h2 id="ruby">Ruby</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">build_factory</span><span class="p">(</span><span class="n">transformations</span><span class="p">)</span>
  <span class="n">factory</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">blueprint</span><span class="o">|</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">blueprint</span>
    <span class="n">log</span> <span class="o">=</span> <span class="p">[</span><span class="n">blueprint</span><span class="p">]</span>
    <span class="k">until</span> <span class="n">result</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Proc</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">transformations</span><span class="p">.</span><span class="nf">reduce</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="o">|</span> <span class="n">t</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span> <span class="p">}</span>
      <span class="c1"># ensure the transformation didn't loop</span>
      <span class="k">raise</span> <span class="s2">"Can't process blueprint "</span> <span class="k">if</span> <span class="n">log</span><span class="p">.</span><span class="nf">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">bp</span><span class="o">|</span> <span class="n">bp</span> <span class="o">==</span> <span class="n">result</span> <span class="p">}</span>
      <span class="n">log</span> <span class="o">&lt;&lt;</span> <span class="n">result</span>
    <span class="k">end</span>

    <span class="n">result</span>
  <span class="k">end</span>

  <span class="n">factory</span>
<span class="k">end</span></code></pre></figure>

<h2 id="clojure">Clojure</h2>

<figure class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">build-factory</span><span class="w"> </span><span class="p">[</span><span class="n">transformations</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nf">letfn</span><span class="w"> </span><span class="p">[(</span><span class="nf">factory</span><span class="w"> </span><span class="p">[</span><span class="n">blueprint</span><span class="p">]</span><span class="w">
            </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="p">[</span><span class="n">result</span><span class="w"> </span><span class="n">blueprint,</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="o">#</span><span class="p">{</span><span class="n">blueprint</span><span class="p">}]</span><span class="w">
              </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">fn?</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w">
                </span><span class="n">result</span><span class="w">
                </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">next-result</span><span class="w"> </span><span class="p">(</span><span class="nb">reduce</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nf">%2</span><span class="w"> </span><span class="n">%1</span><span class="w"> </span><span class="n">factory</span><span class="p">)</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">transformations</span><span class="p">)]</span><span class="w">
                  </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nb">contains?</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="n">next-result</span><span class="p">)</span><span class="w">
                    </span><span class="p">(</span><span class="nf">throw</span><span class="w"> </span><span class="p">(</span><span class="nf">Error.</span><span class="w"> </span><span class="s">"Can't process blueprint"</span><span class="p">)))</span><span class="w">
                  </span><span class="p">(</span><span class="nf">recur</span><span class="w"> </span><span class="n">next-result</span><span class="w"> </span><span class="p">(</span><span class="nb">conj</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="n">next-result</span><span class="p">))))))]</span><span class="w">
    </span><span class="n">factory</span><span class="p">))</span></code></pre></figure>

<h1 id="dsl-example">DSL example</h1>

<h2 id="ruby-1">Ruby</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_dsl_transformations</span> <span class="o">=</span> <span class="p">[</span>
  <span class="o">-&gt;</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="n">bp</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Class</span><span class="p">)</span> <span class="p">?</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="p">}</span> <span class="p">:</span> <span class="n">bp</span> <span class="p">},</span>
  <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">bp</span><span class="p">,</span> <span class="n">f</span><span class="o">|</span>
    <span class="k">return</span> <span class="n">bp</span> <span class="k">unless</span> <span class="n">bp</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Array</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">bp</span><span class="p">.</span><span class="nf">size</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">element_validator</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">bp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Array</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">x</span><span class="p">.</span><span class="nf">all?</span><span class="p">(</span><span class="o">&amp;</span><span class="n">element_validator</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span><span class="p">,</span>
  <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">bp</span><span class="p">,</span> <span class="n">f</span><span class="o">|</span>
    <span class="k">return</span> <span class="n">bp</span> <span class="k">unless</span> <span class="n">bp</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Set</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">bp</span><span class="p">.</span><span class="nf">empty?</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="n">bp</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">validators</span><span class="p">.</span><span class="nf">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
  <span class="k">end</span><span class="p">,</span>
  <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">bp</span><span class="p">,</span> <span class="n">f</span><span class="o">|</span>
    <span class="k">return</span> <span class="n">bp</span> <span class="k">unless</span> <span class="n">bp</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="n">bp</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span> <span class="p">}</span>
                   <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">v</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="p">}</span> <span class="p">}</span>
    <span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">validators</span><span class="p">.</span><span class="nf">all?</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="p">]</span>
<span class="n">my_dsl</span> <span class="o">=</span> <span class="n">build_factory</span><span class="p">(</span><span class="n">my_dsl_transformations</span><span class="p">)</span>
<span class="n">user_validator</span> <span class="o">=</span> <span class="n">my_dsl</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">name: </span><span class="no">String</span><span class="p">,</span>
  <span class="ss">age: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Integer</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">18</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">150</span> <span class="p">},</span>
  <span class="ss">favourite_food: </span><span class="p">[</span><span class="no">String</span><span class="p">],</span>
  <span class="ss">phone: </span><span class="no">Set</span><span class="p">[</span><span class="no">NilClass</span><span class="p">,</span> <span class="no">String</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">user_validator</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">,</span>
  <span class="ss">age: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Integer</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">18</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">150</span> <span class="p">},</span>
  <span class="ss">favourite_food: </span><span class="p">[</span><span class="s2">"Lasagna"</span><span class="p">,</span> <span class="s2">"Borsch"</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># ==&gt; true</span></code></pre></figure>

<h2 id="clojure-1">Clojure</h2>

<figure class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">hashmap-subset-transformation</span><span class="w"> </span><span class="p">[</span><span class="n">blueprint</span><span class="w"> </span><span class="n">factory</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nf">if-not</span><span class="w"> </span><span class="p">(</span><span class="nb">map?</span><span class="w"> </span><span class="n">blueprint</span><span class="p">)</span><span class="w">
    </span><span class="n">blueprint</span><span class="w">
    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">validators</span><span class="w"> </span><span class="p">(</span><span class="nf">-&gt;&gt;</span><span class="w"> </span><span class="n">blueprint</span><span class="w">
                          </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[[</span><span class="n">k</span><span class="w"> </span><span class="n">bp</span><span class="p">]]</span><span class="w"> </span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="p">(</span><span class="nf">factory</span><span class="w"> </span><span class="n">bp</span><span class="p">)]))</span><span class="w">
                          </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[[</span><span class="n">k</span><span class="w"> </span><span class="n">v</span><span class="p">]]</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nf">v</span><span class="w"> </span><span class="p">(</span><span class="nb">get</span><span class="w"> </span><span class="n">%</span><span class="w"> </span><span class="n">k</span><span class="p">)))))]</span><span class="w">
      </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nb">map?</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">every?</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nf">%</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">validators</span><span class="p">))))))</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">my-dsl-transformations</span><span class="w">
  </span><span class="p">[(</span><span class="k">fn</span><span class="w"> </span><span class="p">[</span><span class="n">bp</span><span class="w"> </span><span class="n">f</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">if-not</span><span class="w"> </span><span class="p">(</span><span class="nf">class?</span><span class="w"> </span><span class="n">bp</span><span class="p">)</span><span class="w">
                </span><span class="n">bp</span><span class="w">
                </span><span class="o">#</span><span class="p">(</span><span class="nb">instance?</span><span class="w"> </span><span class="n">bp</span><span class="w"> </span><span class="n">%</span><span class="p">)))</span><span class="w">
   </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[</span><span class="n">bp</span><span class="w"> </span><span class="n">f</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">if-not</span><span class="w"> </span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nb">vector?</span><span class="w"> </span><span class="n">bp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nb">count</span><span class="w"> </span><span class="n">bp</span><span class="p">)))</span><span class="w">
                </span><span class="n">bp</span><span class="w">
                </span><span class="o">#</span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nb">vector?</span><span class="w"> </span><span class="n">%</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">every?</span><span class="w"> </span><span class="p">(</span><span class="nf">f</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">bp</span><span class="p">))</span><span class="w"> </span><span class="n">%</span><span class="p">))))</span><span class="w">
   </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[</span><span class="n">bp</span><span class="w"> </span><span class="n">f</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">if-not</span><span class="w"> </span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nf">set?</span><span class="w"> </span><span class="n">bp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nf">empty?</span><span class="w"> </span><span class="n">bp</span><span class="p">)))</span><span class="w">
                </span><span class="n">bp</span><span class="w">
                </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">validators</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">bp</span><span class="p">)]</span><span class="w">
                  </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">boolean</span><span class="w"> </span><span class="p">(</span><span class="nb">some</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nf">%</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">validators</span><span class="p">))))))</span><span class="w">
   </span><span class="n">hashmap-subset-transformation</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">my-dsl</span><span class="w"> </span><span class="p">(</span><span class="nf">build-factory</span><span class="w"> </span><span class="n">my-dsl-transformations</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">validate-user</span><span class="w">
  </span><span class="p">(</span><span class="nf">my-dsl</span><span class="w">
    </span><span class="p">{</span><span class="no">:name</span><span class="w"> </span><span class="n">String</span><span class="w">
     </span><span class="no">:age</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nf">int?</span><span class="w"> </span><span class="n">%</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;=</span><span class="w"> </span><span class="n">%</span><span class="w"> </span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">%</span><span class="w"> </span><span class="mi">150</span><span class="p">))</span><span class="w">
     </span><span class="no">:favourite-food</span><span class="w"> </span><span class="p">[</span><span class="n">String</span><span class="p">]</span><span class="w">
     </span><span class="no">:phone</span><span class="w"> </span><span class="o">#</span><span class="p">{</span><span class="nb">nil?</span><span class="w"> </span><span class="n">String</span><span class="p">}}))</span><span class="w">

</span><span class="p">(</span><span class="nf">validate-user</span><span class="w"> </span><span class="p">{</span><span class="no">:name</span><span class="w"> </span><span class="s">"John Doe"</span><span class="w">
                </span><span class="no">:age</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">%</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;=</span><span class="w"> </span><span class="n">%</span><span class="w"> </span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">%</span><span class="w"> </span><span class="mi">150</span><span class="p">))</span><span class="w">
                </span><span class="no">:favourite-food</span><span class="w"> </span><span class="p">[</span><span class="s">"Lasagna"</span><span class="w"> </span><span class="s">"Borsch"</span><span class="p">]})</span><span class="w">
</span><span class="c1">;; ==&gt; true</span></code></pre></figure>

<h1 id="conclusion">Conclusion</h1>

<p>This is just a simple example (a prototype, if you will). Some benefits of
approach like this:</p>

<ul>
  <li>The core is minimal so it’s easy to learn</li>
  <li>Because each DSL is created with pure functions, they can easily be re-used</li>
  <li>It’s very portable as no special language features are required. Any
functional or OOP language can have this.</li>
</ul>

<p>My particular example simply returns <code class="language-plaintext highlighter-rouge">true/false</code> but with some tuning it can
return explanations for validation failures.</p>

</article>
<div class="is-size-5">
  
  
  
  <a href="http://twitter.com/share?url=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fyet-another-validation-dsl.html&text=Yet+another+validation+DSL" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-twitter"></i></span></a>
  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fyet-another-validation-dsl.html" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-linkedin"></i></span></a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fyet-another-validation-dsl.html" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-facebook"></i></span></a>
</div>


<script src="https://cdn.fastcomments.com/js/embed-v2.min.js"></script>
<div id="fastcomments-widget"></div>
<script>
  window.FastCommentsUI(document.getElementById('fastcomments-widget'), {
    "tenantId": "yGXgdvu2fN",
    "urlId": "yet-another-validation-dsl"
  });
</script>


    </div>

    <footer id="footer" class="has-background-light">
  <div class="container">
    <div class="columns">
      <div class="column">
        &copy; <a class="has-text-black" href="https://nondv.wtf" target="_blank" rel="noopener"><u>Dmitry Non</u></a>
      </div>
      <div class="column has-text-right">
        <div>
          <a href="https://bulma.io/" target="_blank" rel="noopener"><img src="/img/made-with-bulma.png" alt="bulma logo" width="128"/></a>
        </div>
        <div>
          <a href="https://jekyllrb.com/" target="_blank" rel="noopener"><img src="/img/jekyll-logo.png" alt="jekyll logo" width="128"/></a>
        </div>
        <div>
          Hosted on <a href="https://github.com" target="_blank" rel="noopener"><img id="footer-github-logo" src="/img/github-logo.png" alt="Github logo" width="128"/></a>
        </div>
      </div>
    </div>
  </div>
</footer>
<!-- Cloudflare Web Analytics -->
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "874222a374f745b38a62ba329849c002"}'></script>
<!-- End Cloudflare Web Analytics -->
</body>
</html>
