<!doctype html>
<html lang="en" class="theme-light">
  <head>
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    
<meta itemprop="description" name="description" content="Fun and creative concurrent sorting algorithm" />
<meta property="og:title" content="Sleep sort algorithm" />
<meta property='og:site_name' content='Dmitry Non' />
<meta property="og:url" content="https://nondv.wtf/blog/posts/sleep-sort.html" />
<meta property="og:description" content="Fun and creative concurrent sorting algorithm" />

  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2020-07-02" />
  <meta property="article:author" content="Dmitry Non" />
  <meta property="og:image" content="https://nondv.wtf/img/posts/sleeping.png" />
  <meta property="article:tag" content="sleep sort" />
  <meta property="article:tag" content="sorting" />
  <meta property="article:tag" content="algorithm" />
  <meta property="article:tag" content="Weird Programming" />
  <meta property="article:tag" content="Algorithms" />
  
<meta name="theme-color" content="#4A4A4A"/>
<link rel="apple-touch-icon" href="/img/favicon.svg" />


    <!-- Bulma -->
    <link rel="stylesheet" href="/css/bulma.1.0.4.min.css">
    <!-- Syntax highlight  -->
    <link rel="stylesheet" href="/css/syntax-highlight/perldoc.css">
    <!-- Custom shit and hacks -->
    <link rel="stylesheet" href="/css/other.css">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <title>Sleep sort algorithm</title>
  </head>
  <body>
    <header class="has-background-light mb-4">
  <div class="container">
    <div class="columns is-vcentered">
      <div class="column is-narrow">
        <a href="/">
          <figure id="photo" class="image is-128x128">
            <img class="is-rounded" src="/img/avatar.jpg" />
          </figure>
        </a>
      </div>
      <div class="column">
        <div class="columns is-vcentered">
          <div class="column">
            <div class="title is-size-2">Dmitry Non</div>
            <div class="subtitle is-size-4 mb-4">Software Engineer</div>
            <nav class="breadcrumb has-bullet-separator" aria-label="breadcrumbs">
              <ul><li><a href="/"><span class="icon m-0"><i class="fas fa-user"></i></span>CV</a></li>
                  <li class="is-active"><a><span class="icon m-0"><i class="fas fa-pen"></i></span> Blog</a></li></ul>
            </nav>

          </div>
          <div class="column is-narrow">
            <a href="mailto:mail@nondv.io">
              <span class="icon">
                <i class="far fa-envelope"></i>
              </span>
              mail@nondv.io
            </a>
            <a class="is-block" target="_blank" href="https://www.linkedin.com/in/nondv/">
              <span class="icon">
                <i class="fab fa-linkedin"></i>
              </span>
              Nondv
            </a>
            <a class="is-block" target="_blank" href="https://github.com/Nondv">
              <span class="icon">
                <i class="fab fa-github"></i>
              </span>
              @Nondv
            </a>
            <a class="is-block" target="_blank" href="https://medium.com/@nondv">
              <span class="icon">
                <i class="fab fa-medium"></i>
              </span>
              @nondv
            </a>
            <a class="is-block" href="https://nondv.wtf/blog.html">
              <span class="icon">
                <i class="fas fa-pen"></i>
              </span>
              nondv.wtf/blog
            </a>
            <a class="is-block" href="https://nondv.wtf/blog/feed.xml">
              <span class="icon">
                <i class="fas fa-rss"></i>
              </span>
              Atom feed
            </a>
            <div>London, UK</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>



    <div class="container px-2">
      <nav class="breadcrumb mb-4" aria-label="breadcrumbs">
  <ul>
    <li><a href="/blog.html">Blog</a></li>
    <li><a href="/blog/categories">Categories</a></li>
    <li><div class="dropdown is-hoverable">
          <div class="dropdown-trigger">
            <a href="https://nondv.wtf/blog/categories/weird-programming">
              <span class="icon is-small mr-0 ml-0"><i class="fas fa-angle-down"></i></span>
              Weird Programming
            </a>
          </div>

          <div class="dropdown-menu">
            <div class="dropdown-content"><a style="justify-content: left" class="dropdown-item" href="https://nondv.wtf/blog/categories/algorithms">
                  Algorithms
                </a></div>
          </div>
        </div></li>
    <li class="is-active"><a href="#" aria-current="page">Sleep sort algorithm</a></li>
  </ul>
</nav>

<div class="title is-1">Sleep sort algorithm</div>
<div class="subtitle"><time>2 Jul 2020</time></div>
<div class="is-size-5">
  
  
  
  <a href="http://twitter.com/share?url=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fsleep-sort.html&text=Sleep+sort+algorithm" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-twitter"></i></span></a>
  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fsleep-sort.html" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-linkedin"></i></span></a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fsleep-sort.html" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-facebook"></i></span></a>
</div>
<figure class="mb-6 has-text-centered">
    <img class='post-image' src='/img/posts/sleeping.png' alt='Post image' /></figure><article class="content">
  <p>Some time ago I was doing some small introductions to basic algorithms I learned
back in school to my colleagues at carwow (just for fun).
Some of them became <a href="https://medium.com/programming-basics">posts on medium</a>.</p>

<p>After one of them a colleague told me about sleep sort algorithm. I think it’s
ingenious and should be in my blog.</p>

<!--more-->

<h1 id="algorithm">Algorithm</h1>

<p>The idea is simple and brilliant. Imagine you have a list of numbers you want to
sort.</p>

<ol>
  <li>Create a separate thread for <em>every</em> element in the list.</li>
  <li>In each thread for a corresponding number <code class="language-plaintext highlighter-rouge">x</code> sleep for <code class="language-plaintext highlighter-rouge">x</code> seconds.</li>
  <li>After that print <code class="language-plaintext highlighter-rouge">x</code>.</li>
</ol>

<p>After every thread has finished you will have a sorted list printed out. This
works because lesser <code class="language-plaintext highlighter-rouge">x</code>’s will be “asleep” for shorter periods of time.</p>

<p>Obviously, you don’t have to sleep seconds and you don’t have to print them out,
instead you could push them to stack or something.</p>

<h1 id="clojure-implementation">Clojure implementation</h1>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">sleep-sort</span><span class="w"> </span><span class="p">[</span><span class="n">multiplier</span><span class="w"> </span><span class="n">coll</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">result-atom</span><span class="w"> </span><span class="p">(</span><span class="nf">atom</span><span class="w"> </span><span class="p">[])</span><span class="w">
        </span><span class="n">futures</span><span class="w"> </span><span class="p">(</span><span class="nb">doall</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w">
                        </span><span class="o">#</span><span class="p">(</span><span class="nf">future</span><span class="w"> </span><span class="p">(</span><span class="nf">Thread/sleep</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">%</span><span class="w"> </span><span class="n">multiplier</span><span class="p">))</span><span class="w">
                                 </span><span class="p">(</span><span class="nf">swap!</span><span class="w"> </span><span class="n">result-atom</span><span class="w"> </span><span class="nb">conj</span><span class="w"> </span><span class="n">%</span><span class="p">))</span><span class="w">
                        </span><span class="n">coll</span><span class="p">))]</span><span class="w">
    </span><span class="p">(</span><span class="nf">run!</span><span class="w"> </span><span class="nb">deref</span><span class="w"> </span><span class="n">futures</span><span class="p">)</span><span class="w">
    </span><span class="o">@</span><span class="n">result-atom</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>With <code class="language-plaintext highlighter-rouge">multiplier</code> equal to 1000 the algorithm will sleep <code class="language-plaintext highlighter-rouge">x</code> seconds.</p>

<p>Quite straightforward implementation, for data storage an
<a href="https://clojure.org/reference/atoms">atom</a> is used. For threading I used
<a href="https://clojuredocs.org/clojure.core/future">future</a>.</p>

<p>The only weird thing here (imho) is the line <code class="language-plaintext highlighter-rouge">(run! deref futures)</code>. This is to
make sure that all threads are finished before returning the value stored in the
atom.</p>

<h1 id="go-implementation">Go implementation</h1>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">sort</span><span class="p">(</span><span class="n">array</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="n">d</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
	<span class="n">result</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
	<span class="n">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="k">go</span> <span class="k">func</span><span class="p">(</span><span class="n">x</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>
			<span class="n">ch</span> <span class="o">&lt;-</span> <span class="n">x</span>
		<span class="p">}(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;-</span><span class="n">ch</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">result</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Go is destined to be used as a concurrent procedural language. I really like
this solution even though it’s incredibly wordy.</p>

<p>The program just iterates over the array and creates a goroutine for each
element. Each goroutine pushes valuess into the channel. Classic.</p>

<p>We could also write the same code in Clojure, btw (using
<a href="https://clojuredocs.org/clojure.core.async">core.async</a> library)</p>

<h1 id="ruby-implementation">Ruby implementation</h1>

<p>Ruby is my core skill so I couldn’t leave it out.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">sleep_sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">threads</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
    <span class="no">Thread</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span>
      <span class="nb">sleep</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
      <span class="n">result</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">threads</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:join</span><span class="p">)</span>
  <span class="n">result</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Yep, just a thread per number, pushing to an array, waiting until all threads
are finished.</p>

<p>Ruby doesn’t have a true parallelism though. It remains single-threaded. But
since we use IO-blocking operation (sleep) the interpeter is able to switch
between ruby threads.</p>

<h1 id="performance-and-tuning">Performance and tuning</h1>

<p>Unfortunately, this algorithm heavilly relies on input data limits.</p>

<p>For example, we could make it faster by using multiplier of 100 instead
of 1000. However, for large arrays we would have to understand that the last
thread will be spawned much later than the first one.</p>

<p>Another thing is the range the numbers are in. If your numbers are in 1..100
than you would want to use a bigger multiplier. And the other way around, if
your numbers are in 1000…1000000 you don’t need big ones.</p>

<p>Also the solutions I wrote do not work with negative numbers. For them we could
create a separate datastructure and join them later. Or we could juts use adding
elements to beginning/end depending on the sign:)</p>

<h1 id="final-thoughts">Final thoughts</h1>

<p>This algorithm is completely impractical. However, I think the person who’s come
up with it is a genius. It’s incredibly creative and resourceful. I wish I had a
brain that can come up with something simple and cool as this.</p>

</article>
<div class="is-size-5">
  
  
  
  <a href="http://twitter.com/share?url=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fsleep-sort.html&text=Sleep+sort+algorithm" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-twitter"></i></span></a>
  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fsleep-sort.html" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-linkedin"></i></span></a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnondv.wtf%2Fblog%2Fposts%2Fsleep-sort.html" target="_blank" rel="noopener"><span class="icon"><i class="fab fa-facebook"></i></span></a>
</div>


<script src="https://cdn.fastcomments.com/js/embed-v2.min.js"></script>
<div id="fastcomments-widget"></div>
<script>
  window.FastCommentsUI(document.getElementById('fastcomments-widget'), {
    "tenantId": "yGXgdvu2fN",
    "urlId": "sleep-sort-algorithm"
  });
</script>


    </div>

    <footer id="footer" class="has-background-light">
  <div class="container">
    <div class="columns">
      <div class="column">
        &copy; <a class="has-text-black" href="https://nondv.wtf" target="_blank" rel="noopener"><u>Dmitry Non</u></a>
      </div>
      <div class="column has-text-right">
        <div>
          <a href="https://bulma.io/" target="_blank" rel="noopener"><img src="/img/made-with-bulma.png" alt="bulma logo" width="128"/></a>
        </div>
        <div>
          <a href="https://jekyllrb.com/" target="_blank" rel="noopener"><img src="/img/jekyll-logo.png" alt="jekyll logo" width="128"/></a>
        </div>
        <div>
          Hosted on <a href="https://github.com" target="_blank" rel="noopener"><img id="footer-github-logo" src="/img/github-logo.png" alt="Github logo" width="128"/></a>
        </div>
      </div>
    </div>
  </div>
</footer>
<!-- Cloudflare Web Analytics -->
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "874222a374f745b38a62ba329849c002"}'></script>
<!-- End Cloudflare Web Analytics -->
</body>
</html>
